<div class="d-flex flex-column gap-30" *ngIf="books">
  <div class="table-header d-flex align-items-center gap-10 flex-wrap">
    <mat-icon>library_books</mat-icon>
    <div>
      <h2 class="m-0">{{title}}</h2>
      <p class="m-0">{{desc}}</p>
    </div>

    <button mat-raised-button color="primary" class="d-flex align-items-center gap-5 ml-auto" (click)="openEditDialog()"><mat-icon>add</mat-icon> Add New Book</button>

  </div>

  <div>
    <app-search-input [placeholder]="'Search books or authors...'"
                      [suggestions]="bookTitles"
                      (search)="onSearch($event)"
                      (suggestionSelected)="onSelect($event)">
    </app-search-input>
  </div>

  <div class="table-container">
    <table mat-table [dataSource]="books" class="mat-elevation-z8" style="width: 100%">

      <!-- Id Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let book"> {{ book.id }} </td>
      </ng-container>

      <!-- Title Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef> Title </th>
        <td mat-cell *matCellDef="let book">
          <div class="text-nowrap title" title="{{book.title}}">
            {{ book.title }}
          </div>
        </td>
      </ng-container>

      <!-- Author Column -->
      <ng-container matColumnDef="author">
        <th mat-header-cell *matHeaderCellDef> Author </th>
        <td mat-cell *matCellDef="let book">
          <div class="d-flex align-items-center gap-10">
            <mat-icon>account_circle</mat-icon>
            <div class="text-nowrap author" title="{{book.author}}">
              {{ book.author }}
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Categories Column -->
      <ng-container matColumnDef="categories">
        <th mat-header-cell *matHeaderCellDef> Categories </th>
        <td mat-cell *matCellDef="let book">
          <div class="d-flex align-items-center gap-10" *ngIf="book.categories && book.categories.length > 0">
            <mat-icon>folder_open</mat-icon>

            <div class="text-nowrap category-name">
              <span *ngFor="let c of book.categories; let last = last">
                {{  c.name }}
                <span *ngIf="!last">, </span>
              </span>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef> Action </th>
        <td mat-cell *matCellDef="let book">
          <div class="d-flex align-items-center gap-10">
            <button class="table-action" *ngIf="viewEdit" (click)="openEditDialog(book)">Edit <mat-icon>create</mat-icon></button>
            <button class="table-action" *ngIf="categoryId" (click)="openRemoveConfirmDialog(book)">Remove From Category <mat-icon>close</mat-icon></button>
            <button class="delete-icon" (click)="openDeleteConfirmDialog(book)"><mat-icon>delete_outline</mat-icon></button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</div>


